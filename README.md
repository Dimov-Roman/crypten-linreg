# CrypTen Linear Regression

Обучение линейной регрессии с приватными вычислениями на основе CrypTen от Facebook Research.

## Описание

Этот проект демонстрирует использование Secure Multiparty Computation (MPC) для обучения моделей машинного обучения без раскрытия исходных данных. Система позволяет двум участникам совместно обучать модель линейной регрессии, сохраняя приватность своих данных.

Ключевые особенности:

- Приватные вычисления - данные остаются зашифрованными во время обучения
- Распределённое обучение - несколько участников работают без раскрытия данных друг другу
- Docker Compose - контейнеризация для простого развёртывания
- Конфигурируемость - переменные окружения для настройки параметров
- PyTorch - использование стандартного фреймворка для машинного обучения

## Принцип работы

### Архитектура системы

Система состоит из трёх компонентов:

1. Worker1 (RANK=0) - первый участник с собственным набором данных
2. Worker2 (RANK=1) - второй участник с собственным набором данных  
3. TTP (RANK=2) - доверенная третья сторона для управления ключами и случайностью

Участники синхронизируются через сеть и выполняют совместные вычисления. Каждый worker сохраняет свои данные локально и не передаёт их в открытом виде.

### Процесс обучения

1. Инициализация: Каждый worker создаёт локальные CrypTensor объекты и зашифровывает свои данные
2. Распределение: Зашифрованные данные распределяются между участниками согласно протоколу MPC
3. Обучение: На каждой эпохе:
   - Forward pass: Вычисление предсказаний на зашифрованных данных
   - Loss calculation: Вычисление ошибки в зашифрованном виде
   - Backward pass: Вычисление градиентов в зашифрованном виде
   - Update: Обновление весов модели
4. Завершение: Итоговая модель остаётся зашифрованной или может быть расшифрована при согласии всех участников

### Secure Multiparty Computation

MPC позволяет выполнять вычисления над зашифрованными данными без их расшифровки. Основной механизм:

- Данные разделяются на доли (shares) между участниками
- Каждый participant получает свою долю, которая не раскрывает информацию об исходных данных
- Арифметические операции выполняются над долями
- Результаты комбинируются для получения правильного результата

TTP служит генератором случайности и помогает управлять криптографическими ключами, но не имеет доступа к исходным данным отдельных участников.

### Конфигурационные параметры

Параметры обучения контролируются через переменные окружения:

PRECISION - точность кодирования CrypTen в битах. Определяет баланс между точностью вычислений и использованием памяти. По умолчанию 16.

EPOCHS - количество итераций обучения. По умолчанию 30.

BATCH_SIZE - размер батча для обучения. По умолчанию 512.

LOGLEVEL - уровень логирования системы (DEBUG, INFO, WARNING, ERROR). По умолчанию INFO.

MASTER_ADDR - адрес главного процесса в распределённой системе. По умолчанию worker1.

MASTER_PORT - порт для синхронизации процессов. По умолчанию 29500.

RANK - порядковый номер процесса в системе MPC (0 для worker1, 1 для worker2, 2 для TTP).

WORLD_SIZE - количество участников MPC (не считая TTP). По умолчанию 2.

### Структура компонентов

config.py - управление конфигурацией из переменных окружения

worker.py - точка входа для запуска задач, управление регистрацией и вызовом функций

tasks/mpc.py - реализация MPC задач, включая linreg_homework_compare и ttp функции

Dockerfile - описание Docker образа с установкой зависимостей

docker-compose.yml - оркестрация контейнеров, определение сетей и томов, настройка переменных окружения

## Требования

Python 3.8 и выше
Docker и Docker Compose
PyTorch версии 1.8 и выше
CrypTen из репозитория Facebook Research
4 GB оперативной памяти минимум
Linux или macOS (Windows требует WSL2)

## Зависимости

torch~=1.8.0 - фреймворк для машинного обучения и работы с тензорами

crypten - библиотека для приватных вычислений на основе MPC

## Безопасность

Данные остаются зашифрованными во время всего процесса обучения. Ни один из участников не может получить доступ к данным другого участника без их согласия.

TTP не имеет доступа к исходным данным отдельного участника, но необходима для правильного выполнения протокола MPC.

Используется стандартный криптографический протокол от CrypTen для обеспечения безопасности вычислений.

## Использование

Запуск с Docker Compose:

docker-compose up

Запуск конкретной задачи:

python -m worker call tasks.mpc:linreg_homework_compare

Просмотр логов:

docker-compose logs -f worker1

## Литература

CrypTen Documentation - https://github.com/facebookresearch/crypten

Secure Multiparty Computation - https://en.wikipedia.org/wiki/Secure_multi-party_computation

PyTorch Documentation - https://pytorch.org/docs/

## Автор

Roman Dimov

## Лицензия

MIT License
